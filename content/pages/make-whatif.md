Title: Перевод и оформление Что если?
Slug: make-whatif
Category: Прочее
Date: 2014-06-20 08:00
Source: False
Formulas: True
save_as: make-whatif/index.html
url: make-whatif/

В этом документе собраны краткие описания процессов, в рамках которых статьи проекта [What If?](http://what-if.xkcd.com) переводятся и публикуются на сайте [Что Если?](http://chtoes.li). Документ предназначен для тех, кто хочет разобраться в том, как работает наша кухня переводов и как взаимодействуют между собой переводчики, — то есть главным образом для новых участников.

## Основные принципы перевода

1. Мы публикуем перевод статьи в четверг или, если Рэндал задержался с публикацией, в понедельник (до 23:59 по московскому времени).
2. Мы переводим и оформляем текст так, чтобы его было приятно читать, конвертируем единицы измерения, иногда поясняем неочевидные для русскоязычного читателя моменты.
3. Мы очень внимательно относимся к тому, как именно написана статья. Мы стараемся не допускать пунктуационных, орфографических, смысловых ошибок и выдерживать стиль оригинала.

Да-да, это же написано и в разделе [О нас](/about/) :-).

## Подготовка, перевод и публикация

Если вы переводчик, но по какой-то причине не имеете доступа к одному из упоминаемых далее ресурсов: не получаете писем о новом переводе из списка рассылки, не можете участвовать в Skype-групчате, или проблема в чём-то другом, — [напишите нам](mailto:contact@chtoes.li).

1. Рэндал Монро публикует новую статью, [Dront](http://vk.com/id114286) оформляет «главу» на Нотабеноиде и по почте (через список рассылки) уведомляет переводчиков. (*См. раздел «Оформление „главы“ на Нотабеноиде».*)
2. Переводим фрагменты на Нотабеноиде и обсуждаем варианты перевода. Голосуем, чтобы облегчить работу тому, кто будет сводить выпуск. (*См. раздел «Перевод» и [рекомендации для переводчиков](/translations-style/).*)
3. Когда перевод надписей на картинках устоялся, его нужно нарисовать (обычно мы занимаемся этим в день выпуска). Договариваемся о том, кто рисует, через групчат. (*См. раздел «Отрисовка изображений».*)
4. [Dront](http://vk.com/id114286) (или его заменитель) сводит выпуск, учитывая комментарии к фрагментам и голосование. Иногда быстрые правки принимаются в ходе обсуждения в групчате.
5. Обсуждаем в групчате варианты анонсов, обычно обсуждение инициирует [Dront](http://vk.com/id114286).
6. [Dront](http://vk.com/id114286) (или заместитель) публикует перевод и размещает ссылки в [vk](http://vk.com/whatifrussian), [twitter](http://twitter.com/whatifrussian). Можно делать перепосты :-). (*См. раздел «Размещение статьи на сайте».*)

## Оформление «главы» на Нотабеноиде

Статью нужно будет сконвертировать из html в markdown, поэтому потребуется утилита [html2text](https://github.com/html2text/html2text) или расширение [StackEdit](https://chrome.google.com/webstore/detail/stackedit/iiooodelglhkcpgbajoejffhijaclcdg?hl=en-US&utm_source=chrome-ntp-launcher) для Chrome.

### Установка html2text

Для Windows:

1. Устанавливаем интерпретатор Python c официального сайта [http://www.python.org/ftp/python/3.3.2/python-3.3.2.msi](http://www.python.org/ftp/python/3.3.2/python-3.3.2.msi).
2. При установке выбираем “Add python.exe to path”.
3. Скачиваем [html2text.py](http://i.libc6.org/media/opensource/html2text.py). Этот файл нам и нужен.

Для Linux:

1. Устанавливаем пакет html2text с помощью менеджера пакетов дистрибутива.

### Конвертация и создание «главы» на Нотабеноиде

1. Открываем исходный текст последней статьи What If? (Ctrl+U) и сохраняем всё, что между тегами `<article>` и `</article>` в файл (для примера: `a.html`).
2. Конвертируем в markdown командой[^1]: `html2text -b0 a.html > a.md`, или через StackEdit: меню `Open from` → `Convert HTML to Markdown`, вставляем текст между `<atricle>` и `</article>`, сохраняем в `a.md`.
3. В полученном файле нужно:
    * Добавить символы `>` в начало каждой строки с вопросом и «пустую» строку с символом `>` перед указанием автора вопроса.
    * Изменить базу url’ов картинок на `/uploads/NNN-article-name/` (например, /imgs/a/51/freefall_candy.png → /uploads/051-free-fall/freefall_candy.png).
    * Оформить текст с картинок и title-текст, как описано далее в этом разделе. (*См. подраздел «Оформление текста с изображений».*)
    * Поправить знаки сносок: `[n]` → `[^n]`.
    * Добавить текст сносок непосредственно после тех абзацев, где они эти сноски встречаются.
4. Создаём новую «главу» в [«книге» переводов What If?](http://notabenoid.com/book/41531), импортируем в неё содержимое `a.md`, тип переносов строк: `Два переноса`.
5. Проверяем разбивку на фрагменты. В первом фрагменте должно быть название выпуска.
6. Отправляем переводчикам уведомление со ссылкой на «главу».

[^1]: Если пакет установлен, но команды html2text нет, попробуйте pyhtml2text.

### Ошибки html2text при работе на Windows:

Если при конвертировании выводятся сообщения вроде
```
UnicodeDecodeError: 'utf-8' codec can't decode byte 0x97 in position 218: invalid start byte
```
значит нужно удалить «подозрительные» символы, обычно это тире или кавычки. Под Linux такой проблемы не возникает. (Может, Python3 решит проблему под Windows?)

### Оформление текста с изображений

Для перевода просто помещаем надписи с картинки в `[labels]` и `[/labels]`, а title-текст в кавычках внутри круглых скобок после url’а. Выглядит это так:

```
![](/uploads/101-plastic-dinosaurs/cycle.png "It's the ciiiiiiircle of deaaaaaath ♫")
[labels]
Sunlight
CO<sub>2</sub>
Water
Photosynthesis
Food chain
Oil
Oil rigs
Water vapor
Cars
Speed
CO<sub>2</sub>
[/labels]
```

## Перевод

### Часто используемая функциональность Markdown

У языка разметки Markdown много диалектов, но используемый нами в целом соответствует [каноничному](http://daringfireball.net/projects/markdown/). Если быть точным, мы используем библиотеку [Python-Markdown](https://pythonhosted.org/Markdown/) и соответствующий синтаксис. Здесь собраны часто используемые варианты оформления:

* Разметка текста: `*курсив*`, `**жирный**`.
* Ссылки: `[текст ссылки](http://example.com)`. Ссылки должны оставаться человекочитаемыми: сокращать их и кодировать в %xx-нотацию не нужно (`http://ru.wikipedia.org/wiki/Я` предпочтительней `http://ru.wikipedia.org/wiki/%D0%AF`). Если ссылка ведёт на страницу нашего сайта, базовую часть лучше опустить: `/page-name-here`.
* Изображения: `![](http://example.com/image.png) "alt-текст изображения"`). Ссылка на картинку с нашего сайта обычно выглядит так: `/uploads/id-slug/original_name.png`. (*Про загрузку изображений см. раздел «Размещение статьи на сайте».*)
* Сноски:
```
Lorem ipsum[^1]&thinsp;[^2] dolor sit amet, consectetur adipisicing elit
[^1]: [Lorem ipsum](http://ru.wikipedia.org/wiki/Lorem_ipsum) — название классического текста-«рыбы».
[^2]:
    Между подряд идущими сносками ставится тонкий пробел (&thinsp;).

    Эта сноска содержит два параграфа. Обратите внимание на расстановку отступов.
```
* «Приподнятый» текст (пример<sup>[источник?]</sup>) делается с использованием тега `sup`: `пример<sup>[источник?]</sup>`.
* Формулы оборачиваются в `$` (внутристрочные) или в `$$` (на отдельной строке): `$F_i(x)$`, `$$F_i(x) = i*log_2(x)$$`. Часто нужны:
    * десятичная запятая: `$1{,}5$` → $1{,}5$;
    * разделитель разрядов (тонкий пробел): `$10\,000$` → $10\,000$;
    * текст (в т.&nbsp;ч. русский): `$10\text{ кг}$` → $10\text{ кг}$;
    * знаки умножения и примерного равенства: `$2 \times 2 \approx 5$` → $2 \times 2 \approx 5$.
* Чтобы знак доллара не воспринимался как начало или конец формулы, его нужно экранировать: `от \$30 до \$40`. Если в строке один знак доллара, то экранировать его не обязательно.
* Вопрос оформляется следующим образом:
```
> Что, если я соберусь поплавать в бассейне для отработанного ядерного топлива? Нужно ли мне нырять, чтобы получить фатальную дозу радиации? Насколько долго я смогу продержаться на поверхности?
>
> — Джонатан Бастьен-Филиатро
```

### Рекомендации для переводчиков

В ходе работы у нас выработались определённые рекомендации для переводчиков. Получилось немало, поэтому теперь они живут на [отдельной странице](/translations-style/).

## Отрисовка изображений

* Для перевода картинок нам нужны две вещи: графический редактор (GIMP) и шрифт.
    * Графический редактор можно скачать с официального сайта, там в разделе загрузок будет ссылка на http://nightly.darkrefraction.com/gimp/ скачивать нужно Stable (2.8)
    * Шрифт можно скачать [отсюда](https://github.com/theshock/theshock.github.com/blob/9bb56783a34e920f6e290b5b8e0aff9df23a75ba/trash/xkcdRightHand.ttf?raw=true).
* Интерфейс у GIMP не очень простой, но необходимые нам операции — несложные:
    1. Сперва нам нужно удалить текст: выделяем его (`R`) и жмём `Delete`.
    2. Выбираем инструмент «Текст», выбираем шрифт и размер, копируем перевод, позиционируем его.
    3. Выбираем самый нижний слой (через `Ctrl+L`). Теперь снова можно выделять кусок картинки и очищать его.

TODO: Перевести в markdown статьи про отрисовку XKCD на планшете и про отрисовку с помощью Sarkasm Ink в GIMP.

## Размещение статьи на сайте

### До начала работы

1. На компьютере должны быть установлены:
    * [Python 2.7](https://www.python.org/downloads/);
    * [Pelican](http://docs.getpelican.com/en/3.3.0/getting_started.html#installing-pelican);
    * [Fabric](http://www.fabfile.org/installing.html);
    * [Beautiful Soup 4](http://www.crummy.com/software/BeautifulSoup/);
    * [git](http://git-scm.com/downloads);
    * rsync (под Windows нет).
2. Нужно зарегистрироваться на [github.com](https://github.com) (в т. ч. сгенерировать ключ) и убедиться, что вы включены в организацию [whatifrussian](https://github.com/whatifrussian).
3. Передать **публичный** ключ (`id_rsa.pub`) librarian (aka Nikita Menkovich), чтобы он предоставил вам доступ к сайту.
4. Склонировать репозиторий [website](https://github.com/whatifrussian/website).

### Размещение на сайте

1. Перейти в терминале в директорию репозитория `website`.
2. `fab build:local`, чтобы убедиться, что всё необходимое (кроме rsync) установлено и работает.
3. `git pull`, чтобы убедиться, что локальный репозиторий синхронизирован с основным.
4. `fab new:nnn` (nnn — номер новой статьи), чтобы сделать заготовку (.md файл) для новой статьи.
5. Добавить (и закоммитить) новый материал через git (любым удобным способом): статью и картинки.
6. Если материал добавлен в основной репозиторий, но его ещё нет в локальном, выполнить `git pull`.
7. `fab publish:dev`
8. Открыть [http://dev.chtoes.li/](http://dev.chtoes.li/) и убедиться, что всё отображается корректно.
9. Если материал добавлялся локально, но его ещё нет в основном репозитории, выполнить `git push`.
10. `fab publish:prod`
11. Открыть [http://chtoes.li](http://chtoes.li) и убедиться, что всё отображается корректно.

Мы размещаем оригинальные изображения и их переводы в директории `content/uploads/nnn-article-name`, где `nnn` — номер статьи, а `article-name` — её название в нижнем регистре с заменой букв на дефисы. Названия переведённых изображений оканчиваются на `_ru.png` и за исключением части `_ru` совпадают с оригинальными. Если переводить на картинке нечего, то загружается только оригинал.

При проверке статьи в dev-версии сайта нужно убедиться, что отображаются именно переведённые картинки и, если это не так, скорректировать их url’ы в тексте статьи (добавить `_ru` перед `.png`).
